<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet">

  <meta charset="UTF-8">
  <title>Web Material Map</title>
  <style>
    body {
      background-color: bisque;
      font-family: monospace;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin: 1rem 0 0.25rem;
    }

    #chart {
      margin: 15px;
      width: 1024px;
      height: 960px;
    }

    button {
      margin: 0.5rem;
      padding: 0.45rem 0.9rem;
      font-size: 1rem;
      border-radius: 1em;
      cursor: pointer;
      border-color: gold;
    }

    #controls {
      position: fixed;
      bottom: 0;
      right: 0;
      margin: 20px;
      display: flex;
    }

    /* Tooltip styling */
    #tooltip {
      position: absolute;
      margin: 12px;
      max-width: 50vw;
      pointer-events: none;
      background: #fffbe6;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 14px;
      color: #333;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      display: none;
      z-index: 10;
    }

    /* links */
    .link {
      fill: none;
      stroke: #bbb;
      stroke-width: 1.2px;
    }

    .link.highlight {
      stroke: darkorange;
      stroke-width: 2.5px;
    }

    /* nodes */
    .node circle {
      r: 4px;
      fill: #fff;
      stroke: steelblue;
      stroke-width: 1.5px;
    }

    .node.highlight circle {
      stroke: darkorange;
      stroke-width: 2.5px;
    }

    /* labels */
    .node text {
      font-size: 12px;
      dominant-baseline: central;
      pointer-events: all;
      paint-order: stroke;
      stroke: #fff;
      stroke-width: 5px;
      stroke-linejoin: round;
      cursor: default;
    }

    .node.leaf text {
      /* fill: #0066cc; */
      stroke: gold;
      cursor: pointer;
      pointer-events: all;
      font-style: italic;
    }

    .node.leaf:hover circle {
      fill: #cce5ff;
    }

    @media (min-width:320px)  { 
      /* smartphones, portrait iPhone, portrait 480x320 phones (Android) */ 
      dialog {
        max-width: 90vw;
      }
    }
    @media (min-width:801px)  { 
      /* tablet, landscape iPad, lo-res laptops ands desktops */ 
      dialog {
        max-width: 50vw;
      }
    }
  </style>
</head>

<body>
  <div id="controls">
    <button id="toggleView">radial</button>
    <button id="info">?</button>
  </div>
  <svg id="chart"></svg>
  <div id="tooltip"></div>

  <dialog id="infodialog">
    Come back on a desktop browser!
    <br>
    Web Material exercises are created to run an modern desktops, and have little to no mobile support. Some may only
    work in Chrome; some may require pop-ups or local storage. These aren't necessarily built to run broadly or work
    forever; they are sketches, tests, and experiments that serve a particularly small purpose; exploring how the
    internet and the web can be used as the material for expression.
    <br>
    <br>
    Web Material is a research-in-progress created by <a href="https://leiac.me/">Leia S Chang</a>.
    <form method="dialog">
      <button id="dialogCloseBtn">OK</button>
    </form>
  </dialog>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const infoButton = document.getElementById("info");
    const infodialog = document.getElementById("infodialog");
    const dialogClose = document.getElementById("dialogCloseBtn");

    info.addEventListener("click", () => {
      infodialog.showModal();
    });

    dialogClose.addEventListener("click", () => {
      infodialog.close();
    });

    // check for mobile devices: desktop devices will be able to use hover
    if(window.matchMedia("(any-hover:none)").matches) { 
      infodialog.showModal();
    }
    /* ------------------------------------------------------------------
     * 1. DATA (unchanged)
     * ----------------------------------------------------------------*/
    const data = {
      name: "Web Material",
      description: "Web Material is an exercise in considering the web (its elements, its characteristics, its members) as a material that can be played with, used as a storytelling mechanism, and as a vessel for art making. At its core, this is a map of the places that I have explored in this thought processess; entirely unfinished, incomplete, and in progress. *** Web material changes quickly over time, unique not in its change but the rapid nature of it, along with its ability to self-document and archive. *** Most of these experiments are desktop-only, some require pop-ups, some probably won't work well on browsers outside of Chrome.",
      children: [
        {
          name: "Text",
          description: "Text, with meaning and without meaning. This is all characters on screen.",
          children: [
            {
              name: "Characters",
              children: [
                { name: "asterisk drawing", url: "https://leils.github.io/web-sites/asterisk_drawing.html", description: "Character visibility traces where your cursor moves, drawing its history." },
                { name: "spotlight", url: "https://leils.github.io/web-sites/spotlight.html", description: "Thought: what happens if elements on the screen want to avoid you?" }
              ]
            },
            {
              name: "Ascii",
              children: [
                { name: "runner", url: "https://leils.github.io/web-sites/runner.html", description: "Animating ASCII with clicks" }
              ]
            },
            {
              name: "Visibility",
              children: [
                { name: "blackout", url: "https://leils.github.io/web-sites/blackout.html", description: "Interactive blackout poetry" },
                { name: "shush", url: "https://leils.github.io/web-sites/sleepy.html", description: "Website with personality using only one characteristic.  Playing with visibility and interaction." },
                { name: "sick", url: "https://leils.github.io/web-sites/spans.html", description: "Another experiment with visibility fog and cursor passover" }
              ]
            },
            { name: "hello", url: "https://leils.github.io/web-sites/hello.html", description: "Simple hover + vis + text" },
            { name: "alternates 2", url: "https://leils.github.io/web-sites/alternates2.html", description: "Translation makes many alternatives. Re-translate my name by clicking the english versions."},
            { name: "horoscope", url: "https://leils.github.io/web-sites/horoscope.html", description: "Algorithmic cutout poetry horoscope" },
          ]

        },
        {
          name: "HTML Elements",
          description: "Core elements, building blocks of the web. How do we use them in unexpected ways?",
          children: [
            {
              name: "<radio>",
              children: [
                { name: "options", url: "https://leils.github.io/web-sites/options.html", description: "Selector that never ends, a false choice." },
                { name: "options (revisited)", url: "https://leils.github.io/web-sites/taper-16/options.html", description: "Binary choices with non-binary results" },
                { name: "select", url: "https://leils.github.io/web-sites/select.html", description: "A grid of radios becomes a puzzle. What happens when radio buttons affect each other?"},
                { name: "firework", url: "https://leils.github.io/web-sites/firework.html", description: "Radio grid becomes an animation surface" },
                { name: "ripple", url: "https://leils.github.io/web-sites/ripple.html", description: "Radio grid as animation surface, part 2" },
              ]
            },
            {
              name: "<select>",
              children: [
                { name: "participation", url: "https://leils.github.io/web-sites/participation.html", description: "How the site feels about you selecting an option" },
              ]
            },
            {
              name: "<range>",
              description: "Ranges across things that aren't numbers",
              children: [
                { name: "locations", url: "https://leils.github.io/web-sites/locations.html", description: "Range from here to there" },
                { name: "airplane", url: "https://leils.github.io/web-sites/airplane.html", description: "Fly with me" },
                { name: "today", url: "https://leils.github.io/web-sites/10to10.html" , description: "A diary of those I was with across a day"},
                { name: "cost", url: "https://leils.github.io/web-sites/cost.html", description: "Cost not as a number" },
                { name: "cost", url: "https://leils.github.io/web-sites/taper-16/fromto.html", description: "from~to ... which are you" },
              ]
            },
            {
              name: "<img>",
              children: [
                { name: "snapshot", url: "https://leils.github.io/web-sites/snapshot.html", description: "Take a polaroid with me" },
                { name: "stopmotion", url: "https://leils.github.io/web-sites/stopmotion.html", description: "CSS img as animation" },
              ]
            },
            {
              name: "<embed>",
              children: [
                { name: "embeded", url: "https://leils.github.io/web-sites/embed.html", description: "The limit of embeds was lower than I thought"}
              ]
            }
          ]
        },
        {
          name: "Browser Objects",
          description: "Non-HTML browser objects",
          children: [
            {
              name: "Cursor",
              description: "The cursor is interesting ... it almost feels like you, feels like your embodiment on the page.",
              children: [
                { name: "change", url: "https://leils.github.io/web-sites/change.html", description: "What's changing? (Only works on Chrome.)" }
              ]
            },
            {
              name: "Windows",
              description: "Our portals, tunnels to the sites we visit.",
              children: [
                {
                  name: "Pop-ups",
                  description: "Window children ~ requires pop-ups to be allowed, only tested in Chrome",
                  children: [
                    { name: "stickey note brain", url: "https://leils.github.io/web-sites/stickynotebrain.html", description: "Too many all at once" },
                    { name: "attention", url: "https://leils.github.io/web-sites/attention.html", description: "Like the pop-ups of old" },
                    { name: "inescapable", url: "https://leils.github.io/web-sites/inescapable.html", description: "Stubbornness, in window form" },
                    { name: "hydra", url: "https://leils.github.io/web-sites/hydra.html", description: "Cut off the head" }
                  ]
                },
              ]
            }
          ]
        },
        {
          name: "Interactions",
          children: [
            {
              name: "Memory",
              description: "Local in-browser memory usage",
              children: [
                { name: "visit", url: "https://leils.github.io/web-sites/visit.html", description: "Remembers how many times you've visited"},
                { name: "alone", url: "https://leils.github.io/web-sites/alone2.html" , description: "Remembers you, and the time in between"},
              ]
            },
            {
              name: "Hover",
              description: "A trace of your movement and presence on the page, a half-active choice",
              children: [
                { name: "alternate(s)", url: "https://leils.github.io/web-sites/alternates.html", description: "Alternate realities in the same space" },
                { name: "flashlight", url: "https://leils.github.io/web-sites/flashlight.html", description: "Holding your flashlight in the dark" },
                { name: "biofluorescence", url: "https://leils.github.io/web-sites/biofluorescence.html", description: "Read what you can in the trace of your movement"},
                { name: "blur", url: "https://leils.github.io/web-sites/blur.html", description: "Wiping away? Peering through?" }

              ]
            },
            {
              name: "Scroll",
              description: "Your online navigation",
              children: [
                { name: "sfcfcfc", url: "https://leils.github.io/web-sites/sfcfcfc.html", description: "Inspired by the San Francisco City Football Club Fan Club" }
              ]
            }
          ]
        },
        {
          name: "Recognizable Players",
          description: "Sites around the web whose visual language is meaningful. Do their languages become an inherent part of the material?",
          children: [
            { name: "access", url: "https://leils.github.io/access/",description: "Built with presentation hiccups in mind" },
            { name: "slides", url: "https://docs.google.com/presentation/d/e/2PACX-1vTdUm0u7VKJPJKU7NUoPc9nRmk9IJuWjLyCyXkYOEUKU1KbhuUCoaGrT5GKOlIniLXpQU8IBOCHwg8M/pub?start=true&loop=true&delayms=100&slide=id.g375f7a0590c_1_54", description: "This animation is actually a published google slide presentation with auto-advancing, which it turns out you can arbitrarily set the delay of." }
          ]
        }
      ]
    };

    /* ------------------------------------------------------------------
     * 2. SVG + layout helpers
     * ----------------------------------------------------------------*/
    const diameter = 960,
      radius = diameter / 2;

    const svg = d3.select("#chart")
      .attr("viewBox", [-radius, -radius, diameter, diameter])
      .style("font", "10px monospace");

    // Link generator for curved Cartesian paths (left ➜ right)
    const linkHorizontal = d3.linkHorizontal()
      .x(d => d.y - radius)
      .y(d => d.x - radius);

    // Helper to convert polar → Cartesian for radial layout
    const project = (angle, r) => [
      Math.cos(angle - Math.PI / 2) * r,
      Math.sin(angle - Math.PI / 2) * r
    ];

    /* ------------------------------------------------------------------
     * 3. Draw / update routine
     * ----------------------------------------------------------------*/
    let radial = true;
    document.getElementById("toggleView").addEventListener("click", () => {
      radial = !radial;
      document.getElementById("toggleView").textContent = radial ? "cartesian" : "radial";
      updateTree();
    });

    function updateTree() {
      svg.selectAll(".nodes, .links").remove();

      // Choose layout
      const layout = radial
        ? d3.cluster().size([2 * Math.PI, radius - 120])
        : d3.tree().size([radius * 1.8, diameter - 200]);

      const root = d3.hierarchy(data);
      layout(root);

      /* ---- Links ---- */
      svg.append("g").attr("class", "links")
        .selectAll("path")
        .data(root.links())
        .join("path")
        .attr("class", "link")
        .attr("d", d => radial
          // Radial (cubic Bézier in polar space)
          ? `M${project(d.target.x, d.target.y)}C${project(d.target.x, (d.target.y + d.source.y) / 2)} ${project(d.source.x, (d.target.y + d.source.y) / 2)} ${project(d.source.x, d.source.y)}`
          // Cartesian (curved horizontal link)
          : linkHorizontal({ source: d.source, target: d.target })
        );

      /* ---- Nodes ---- */
      const node = svg.append("g").attr("class", "nodes")
        .selectAll("g")
        .data(root.descendants())
        .join("g")
        .attr("class", d => "node" + (d.children ? "" : " leaf"))
        .attr("transform", d => radial
          ? `translate(${project(d.x, d.y)})`
          : `translate(${d.y - radius},${d.x - radius})`)
        .on("mouseover", handleMouseOver)
        .on("mousemove", handleMouseMove)
        .on("mouseout", handleMouseOut);

      node.append("circle");

      // Labels
      node.append("text")
        .attr("dy", "0.31em")
        .attr("x", d => radial ? (d.x < Math.PI ? 10 : -10) : 8)
        .attr("text-anchor", d => radial ? (d.x < Math.PI ? "start" : "end") : "start")
        .attr("transform", d => radial ? `rotate(${(d.x * 180 / Math.PI - 90 + (d.x > Math.PI ? 180 : 0))})` : null)
        .text(d => d.data.name)
        .on("click", (event, d) => {
          if (!d.children && d.data.url) window.open(d.data.url, "_blank");
        })
        .on("mouseover", handleMouseOver)
        .on("mousemove", handleMouseMove)
        .on("mouseout", handleMouseOut);
    }

    /* ------------------------------------------------------------------
     * 4. Highlight-on-hover helpers
     * ----------------------------------------------------------------*/
    function handleMouseOver(event, d) {
      const pathNodes = new Set();
      let cur = d;
      while (cur) { pathNodes.add(cur); cur = cur.parent; }
      svg.selectAll(".node").classed("highlight", n => pathNodes.has(n));
      svg.selectAll(".link").classed("highlight", l => pathNodes.has(l.target));
      if (d.data.description) {
        const tooltip = document.getElementById("tooltip");
        tooltip.textContent = d.data.description;
        tooltip.style.display = "block";
        const padding = 12;
        tooltip.style.left = (event.clientX + padding) + "px";
        tooltip.style.top = (event.clientY + padding) + "px";
      }
    }

    function handleMouseMove(event, d) {
      if (d.data.description) {
        const tooltip = document.getElementById("tooltip");
        const padding = 12;
        // Use clientX/clientY plus scroll offsets to get correct position regardless of zoom and scroll
        const x = event.clientX + window.scrollX + padding;
        const y = event.clientY + window.scrollY + padding;
        tooltip.style.left = x + "px";
        tooltip.style.top = y + "px";
      }
    }

    function handleMouseOut(event, d) {
      svg.selectAll(".highlight").classed("highlight", false);
      const tooltip = document.getElementById("tooltip");
      tooltip.style.display = "none";
    }

    // Initial render
    updateTree();
  </script>
</body>

</html>